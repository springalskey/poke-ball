#!/usr/bin/env node

var program = require('commander');
var child_process = require('child_process');
var colors = require('colors');

var version = require('../package.json').version;
var FileTools = require('../tools/file.js').FileTools;
var DirTools = require('../tools/file.js').DirTools;
var path = require('../tools/path');
require('../tools/string');

program.parse(process.argv);

var args = program.args;
var moduleName = args[0];

var data = moduleName.split('/');
var length = data.length;
var views, subViews, leafViews;

switch (length) {
  case 1:
    views = data[0];
    // 只有一个参数，
    // 只要新建一个views
    // 如果存在，return
    createViews(views);
    break;

  case 2:
    views = data[0];
    subViews = data[1];
    /**
     * 有两个参数
     * 如果有views，如果有subViews，
     * 没有views，新建views，新建subViews
     */
    createViews(views);
    createSubViews(views, subViews);
    break;

  case 3:
    views = data[0];
    subViews = data[1];
    leafViews = data[2];

    /**
     * 有3个参数
     * 如果有views，新建subViews
     * 如果没有views，新建subViews，新建leafViews
     */
    createViews(views);
    createSubViews(views, subViews);
    createLeafViews(views, subViews, leafViews);
    break;

  default:

}

// 新建模块，如果存在直接抛错，return
function createViews(views) {
  /** kk views start **/
  //判断需要创建的模块是否存在
  if (DirTools.isExist(`${path.SEED_SRC_VIEWS}/${views}`)) {
    console.log('该模块已存在'.red);
    return;
  }

  // 创建views/module Dir
  DirTools.mkDir(`${path.SEED_SRC_VIEWS}/${views}`);
  console.log(`create module directory ${views} success`.green);

  // 创建views/module/list Dir
  DirTools.mkDir(`${path.SEED_SRC_VIEWS}/${moduleName}/list`);
  console.log(`create module/list directory ${moduleName}/list success`.green);

  // 创建views/module/index.js文件
  var content = FileTools.readFile(`${path.CLI_TEM_VIEWS}/index.js`).toString();
  content = content.replace(/{moduleName}/g, moduleName);
  FileTools.createFile(`${path.SEED_SRC_VIEWS}/${moduleName}/index.js`, content);
  console.log(`create module file : index.js success`.green);

  // 创建views/module/list/index.vue 文件
  var content = FileTools.readFile(`${path.CLI_TEM_VIEWS}/list/index.vue`).toString();
  content = content.replace(/{moduleName}/g, moduleName + '/list');
  FileTools.createFile(`${path.SEED_SRC_VIEWS}/${moduleName}/list/index.vue`, content);
  console.log(`create module/index file : index.vue success`.green);

  // 修改views/index(route).js
  var content = FileTools.readFile(`${path.SEED_SRC_VIEWS}/route.js`).toString();
  content = content.replace(/\nexport default \[/, `import ${moduleName.firstUppserCase()}Routes from './${moduleName}';\n\nexport default [\n  ...${moduleName.firstUppserCase()}Routes,`);
  FileTools.createFile(`${path.SEED_SRC_VIEWS}/index.js`, content);

  // 修改layout/sideMenu.vue
  var content = FileTools.readFile(`${path.SEED_SRC_VIEWS}/layout/sideMenu.vue`).toString();
  content = content.replace(/<\/el-menu>/,
    `  <el-submenu index="sub_2">
        <template slot="title"><i class="el-icon-menu"></i>${moduleName}</template>
        <el-menu-item index="/${moduleName}/list">list</el-menu-item>
        <!-- subviews:${moduleName} -->
      </el-submenu>
    <\/el-menu>`);
  FileTools.createFile(`${path.SEED_SRC_VIEWS}/layout/sideMenu.vue`, content);
  /** kk views end **/
  console.log(`create  module: ${moduleName} success`.green);

}

// 新建子模块，如果存在直接抛错，return
function createSubViews(views, subViews) {

}

// 新建叶子模块，如果存在直接抛错，return
function createLeafViews(views, subViews, leafViews) {

}
